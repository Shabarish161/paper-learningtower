---
title: "learningtower: an R package for Exploring Standardised Test Scores Across the Globe"
abstract: >
  An abstract of less than 150 words - Discuss what the paper talks about with a little introduction.
draft: true
author: 
  # see ?rjournal_article for more information
  - name: Priya Ravindra Dingorkar
    url: https://www.linkedin.com/in/priya-dingorkar/
    email: priyadingorkar@gmail.com
    affiliation: Monash University
    address:
    - Department Econometrics and Business Statistics
    - Clayton, Australia
  - name: Kevin Y.X. Wang
    affiliation: University of Sydney
    address:
    - Data scientist
    - Illumina, Inc. 
    - School of Mathematics and Statistics 
    - Sydney, Australia
    url: https://kevinwang09.github.io/
    email: kevinwangstats@gmail.com 
  - name: Dianne Cook
    affiliation: Monash University
    address:
    - Department Econometrics and Business Statistics
    - Clayton, Australia
    url: http://dicook.org/
    email: dicook@monash.edu
type: package
creative_commons: CC BY
output: 
  rjtools::rjournal_web_article
header-includes:
    \usepackage{float}
    \floatplacement{figure}{H}
bibliography: learningtower.bib
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      error = FALSE)
```

```{r loadlibraries}
library(rjtools)
library(learningtower)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(patchwork)
library(viridis)
library(plotly)
```

# Introduction

The Organization for Economic Cooperation and Development [OECD](OECD - https://www.oecd.org/about/) is a global organization that aims to create better policies for better lives. Its mission is to create policies that promote prosperity, equality, opportunity, and well-being for all. [PISA](PISA - https://www.oecd.org/pisa/) is one of OECD's Programme for International Student Assessment. PISA assesses 15-year-old students' potential to apply their knowledge and abilities in reading, mathematics, and science to real-world challenges. OECD launched this in 1997, it was initially administered in 2000, and it currently includes over [80 nations](https://www.oecd.org/pisa/aboutpisa/pisa-participants.htm). The PISA study, conducted every three years, provides comparative statistics on 15-year-olds' performance in reading, maths, and science. This paper describes how to utilize the `learningtower` package, which offers OECD PISA datasets from 2000 to 2018 in an easy-to-use format. This dataset comprises information on their test results and other socioeconomic factors, as well as information on their schools, infrastructure and the countries participating in the program.

# What is PISA?

PISA assesses the extent to which children approaching the end of compulsory school have learned some of the information and abilities required for full participation in modern society, notably in maths, reading, and science. The examination focuses on reading, mathematics, science, and problem solving. It also assesses students capacity to replicate information and extrapolate from what they have learned and apply that knowledge in unexpected circumstances, both inside and outside of school. This approach reflects the fact that individuals are rewarded in modern economies not for what they know, but for what they can accomplish with what they know. 

This evaluation which is carried out every three years, assists in identifying students' development of knowledge and skills throughout the world, which can provide actionable insights and therefore assist education policymakers. PISA is well known for its distinctive testing characteristics, which include policy orientation, an innovative notion of literacy, relevance to lifelong learning, regularity, and breadth of coverage. PISA is now used as an assessment tool in many regions around the world. In addition to OECD member countries, the survey has been or is being conducted in East, South and Southeast Asia, Central, Mediterranean and Eastern Europe, and Central Asia, The Middle East, Central and South America and Africa. 

For each year of the PISA study, one domain subject is thoroughly examined. In 2018, for example, reading was assessed alongside mathematics and science as minor areas of assessment. The 2012 survey concentrates on mathematics, with reading, science, and problem solving serving as minor evaluation topics. PISA targets a certain age group of students in order to properly compare their performance worldwide. PISA students are aged between 15 years 3 months and 16 years 2 months at the time of the assessment, and have completed at least 6 years of formal schooling. They can enroll in any sort of institution, participate in full-time or part-time education, academic or vocational programs, and attend public, private, or international schools inside the country. Using this age across nations and throughout time allows PISA to compare the knowledge and abilities of people born in the same year who are still in school at the age of 15, irrespective of their diverse schooling.

The PISA test is primarily computer-based and lasts around 2 hours. The examination comprises both multiple choice and free entry questions. Some countries that were not ready for computer-based delivery carried out the testing on paper. Each student may have a unique set of questions. An example of the test may be seen [here](https://www.oecd.org/pisa/test/). PISA assessment areas seek to measure the following aspects of students' literacy in math, reading, and science. The goal of mathematical literacy is to assess students ability to grasp and interpret mathematics in a variety of settings. Reading literacy assesses students' capacity to absorb, apply, analyze, and reflect on texts in order to attain required goals and participate in society. Science literacy is described as the ability to engage with science-related issues and scientific concepts as a reflective citizen.

PISA data is publicly accessible for [download](https://www.oecd.org/pisa/data/). Furthermore, reading the [data documentation](https://www.oecd.org/pisa/data/pisa2018technicalreport/Ch.09-Scaling-PISA-Data.pdf) reveals that the disclosed PISA scores are generated using a sophisticated linear model applied to the data. For each student, several values are simulated. This is known as synthetic data, and it is a popular technique to ensuring data privacy. The data can still be deemed accurate within the mean, variance, and stratum used in the original data's modelling. In addition, the PISA website provides the data in SPSS and SAS format, which can limit accessibility due to the commercial nature of these software. Furthermore, all questions are assigned with unique IDs within each year of the PISA study, but do not always agree across the different years. This data has now been curated and simplified into a single R package called `learningtower`, which contains all of the PISA scores from the years 2000 to 2018.

# Data Compilation

An intense component of disseminating this data is the process of acquiring and measuring information on variables of relevance for the development of `learningtower.` Each author was initially given a certain year for the PISA experiment, and they worked with the survey data from that year. The data was first acquired from the PISA database, which is open to the public and contains information on students' test results as well as school statistics. This data was eventually put into the R environment, and after some data cleaning and wrangling with the appropriate script, the variables of interest were subgrouped, saved, and exported in RDS format. Similarly, datasets were filtered from their raw form to a curated version for each year that PISA was administered. One significant issue that the developers found was ensuring the consistency of variables over various years. For example, a student's mother's highest level of education was never recorded in 2000, but it was categorized as "ST11R01" between 2003 and 2012 and "ST005Q01TA" between 2015 and 2018. Such problems were tackled by manually curating these values as an integer variable named "mother educ" in the output data. These final RDS formats of data for each PISA year are now thoroughly vetted and made available in the learningtower package.

# What is`learningtower`?

['learningtower'](https://cran.r-project.org/web/packages/learningtower/index.html) is an easy-to-use R package that provides quick access to a variety of variables using OECD PISA data collected over a three-year period from 2000 to 2018. This dataset includes information on the PISA test scores in mathematics, reading, and science. Furthermore, these datasets include information on other socioeconomic aspects, as well as information on their school and its facilities, as well as the nations participating in the program. 

The motivation for developing the `learningtower` package was sparked by the announcement of the PISA 2018 results, which caused a collective wringing of hands in the Australian press, with headlines such as ["Vital Signs: Australia's slipping student scores will lead to greater income inequality"](https://theconversation.com/vital-signs-australias-slipping-student-scores-will-lead-to-greater-income-inequality-128301) and ["In China, Nicholas studied maths 20 hours a week. In Australia, it's three"](https://www.smh.com.au/education/in-china-nicholas-studied-maths-20-hours-a-week-in-australia-it-s-three-20191203-p53ggv.html). That's when several academics from Australia, New Zealand, and Indonesia decided to make things easier by providing easy access to PISA scores as part of the [ROpenSci OzUnconf](https://ozunconf19.ropensci.org/), which was held in Sydney from December 11 to 13, 2019. The data from this survey, as well as all other surveys performed since the initial collection in 2000, is freely accessible to the public. However, downloading and curating data across multiple years of the PISA study could be a time consuming task. As a result, we have made a more convenient subset of the data freely available in a new R package called `learningtower`, along with sample code for analysis. 

The `learningtower` package primarily comprised of three datasets: `student`, `school`, and `countrycode.` The `student` dataset includes results from triennial testing of 15-year-old students throughout the world. This dataset also includes information about their parents' education, family wealth, gender, and presence of computers, internet, vehicles, books, rooms, desks, and other comparable factors. Due to the size limitation on CRAN packages, only a subset of the student data can be made available in the downloaded package. These subsets of the student data, known as the `student_subset_yyyy` (`yyyy` being the specific year of the study) allow uses to quickly load, visualise the trends in the full data. The full student dataset can be downloaded using the `load_student()` function included in this [package.](https://kevinwang09.github.io/learningtower/) The `school` dataset includes school weight as well as other information such as school funding distribution, whether the school is private or public, enrollment of boys and girls, school size, and similar other characteristics of interest of different schools these 15-year-olds attend around the world. The `countrycode` dataset includes a mapping of a country/region's ISO code to its full name.

`learningtower` developers are committed to providing R users with data to analyse PISA results every three years. Our package's future enhancements include updating the package every time additional PISA scores are announced. Note that, in order to account for post COVID-19 problems, OECD member nations and associates decided to postpone the PISA 2021 evaluation to 2022 and the PISA 2024 assessment to 2025.

# Example Analysis

In this section we will illustrate how the `learningtower` package can be utilized to answer some research questions by applying various methodologies and statistical computations on the `learningtower` datasets.

# Gender Analysis

Write everything about the research question one


## Math Plot

```{r gendergap, fig.height = 14, fig.width = 6, fig.align = "center", fig.pos="H"}

student_2018 <- load_student("2018")
data(countrycode)

student_country <- left_join(student_2018, countrycode, by = "country")


#removing na values
math_pisa_2018_data <- student_country %>% 
  filter(!is.na(gender)) %>% 
  filter(!is.na(math)) %>% 
  filter(!is.na(stu_wgt)) 

#avg math scores and diff 
math_diff_df <- math_pisa_2018_data %>%
group_by(gender, country_name) %>%
summarise(avg = weighted.mean(math, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender,
values_from = avg) %>%
mutate(diff = female - male,
country_name = fct_reorder(country_name, diff))



#Bootstrap using R: Part 1
set.seed(2020) # for reproducibility
boot_sample1_math <- math_pisa_2018_data %>%
group_by(country_name, gender) %>%
sample_n(size = n(), replace = TRUE)

boot_sample1_df_math <- boot_sample1_math %>%
summarise(avg = weighted.mean(math, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender, values_from = avg) %>%
mutate(diff = female - male, country_name = fct_reorder(country_name, diff))

#Bootstrap using R: Part 2
boot_ests_math <- map_dfr(1:100, ~{
math_pisa_2018_data %>%
group_by(country_name, gender) %>%
sample_n(size = n(), replace = TRUE) %>%
summarise(avg = weighted.mean(math, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender, values_from = avg) %>%
mutate(diff = female - male, country_name = fct_reorder(country_name, diff)) %>%
mutate(boot_id = .x)
})

#Bootstrap using R: Part 3
math_diff_conf_intervals <- boot_ests_math %>%
group_by(country_name) %>%
summarise(lower = sort(diff)[5],
upper = sort(diff)[95])%>%
left_join(math_diff_df, by = "country_name") %>%
mutate(country_name = fct_reorder(country_name, diff)) %>% 
mutate(score_class = ifelse(diff < 0, 'red', 'blue'))


math_plot <- ggplot(math_diff_conf_intervals, 
                    aes(diff, country_name, 
                        col = score_class)) +
geom_point() +
geom_errorbar(aes(
xmin = lower,
xmax = upper)) +
geom_vline(xintercept = 0, color = "red") +
labs(y = "",
x = "Maths Scores Girls - Boys", 
title = "Maths") +
 theme(legend.position="none")
```


##  Read Plot

```{r}
#removing na values
read_pisa_2018_data <- student_country %>% 
  filter(!is.na(gender)) %>% 
  filter(!is.na(read)) %>% 
  filter(!is.na(stu_wgt)) 

#avg math scores and diff 
read_diff_df <- read_pisa_2018_data %>%
group_by(gender, country_name) %>%
summarise(avg = weighted.mean(read, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender,
values_from = avg) %>%
mutate(diff = female - male,
country_name = fct_reorder(country_name, diff))




#Bootstrap using R: Part 1
set.seed(2020) # for reproducibility
boot_sample1_read <- read_pisa_2018_data %>%
group_by(country_name, gender) %>%
sample_n(size = n(), replace = TRUE)

boot_sample1_df_read <- boot_sample1_read %>%
summarise(avg = weighted.mean(read, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender, values_from = avg) %>%
mutate(diff = female - male, country_name = fct_reorder(country_name, diff))

#Bootstrap using R: Part 2
boot_ests_read <- map_dfr(1:100, ~{
read_pisa_2018_data %>%
group_by(country_name, gender) %>%
sample_n(size = n(), replace = TRUE) %>%
summarise(avg = weighted.mean(read, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender, values_from = avg) %>%
mutate(diff = female - male, country_name = fct_reorder(country_name, diff)) %>%
mutate(boot_id = .x)
})

#Bootstrap using R: Part 3
read_diff_conf_intervals <- boot_ests_read %>%
group_by(country_name) %>%
summarise(lower = sort(diff)[5],
upper = sort(diff)[95])%>%
left_join(read_diff_df, by = "country_name") %>%
mutate(country_name = fct_reorder(country_name, diff)) %>% 
mutate(score_class = ifelse(diff < 0, 'red', 'blue'))


read_plot <- ggplot(read_diff_conf_intervals, 
                    aes(diff, country_name, 
                        col = score_class)) +
geom_point() +
geom_errorbar(aes(
xmin = lower,
xmax = upper)) +
geom_vline(xintercept = 0, color = "red") +
labs(y = "",
x = "Reading Scores Girls - Boys", 
title = "Reading") +
 theme(legend.position="none")
```



## Sci Plot

```{r}
#removing na values
sci_pisa_2018_data <- student_country %>% 
  filter(!is.na(gender)) %>% 
  filter(!is.na(science)) %>% 
  filter(!is.na(stu_wgt)) 

#avg math scores and diff 
sci_diff_df <- sci_pisa_2018_data %>%
group_by(gender, country_name) %>%
summarise(avg = weighted.mean(science, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender,
values_from = avg) %>%
mutate(diff = female - male,
country_name = fct_reorder(country_name, diff))




#Bootstrap using R: Part 1
set.seed(2020) # for reproducibility
boot_sample1_sci <- sci_pisa_2018_data %>%
group_by(country_name, gender) %>%
sample_n(size = n(), replace = TRUE)

boot_sample1_df_sci <- boot_sample1_sci %>%
summarise(avg = weighted.mean(science, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender, values_from = avg) %>%
mutate(diff = female - male, country_name = fct_reorder(country_name, diff))

#Bootstrap using R: Part 2
boot_ests_sci <- map_dfr(1:100, ~{
sci_pisa_2018_data %>%
group_by(country_name, gender) %>%
sample_n(size = n(), replace = TRUE) %>%
summarise(avg = weighted.mean(science, stu_wgt)) %>%
ungroup() %>%
pivot_wider(country_name, names_from = gender, values_from = avg) %>%
mutate(diff = female - male, country_name = fct_reorder(country_name, diff)) %>%
mutate(boot_id = .x)
})

#Bootstrap using R: Part 3
sci_diff_conf_intervals <- boot_ests_sci %>%
group_by(country_name) %>%
summarise(lower = sort(diff)[5],
upper = sort(diff)[95])%>%
left_join(sci_diff_df, by = "country_name") %>%
mutate(country_name = fct_reorder(country_name, diff))%>% 
mutate(score_class = ifelse(diff < 0, 'red', 'blue'))


sci_plot <- ggplot(sci_diff_conf_intervals, 
                    aes(diff, country_name, 
                        col = score_class)) +
geom_point() +
geom_errorbar(aes(
xmin = lower,
xmax = upper)) +
geom_vline(xintercept = 0, color = "red") +
labs(y = "",
x = "Science Scores Girls - Boys", 
title = "Science") +
 theme(legend.position="none")
```

```{r score-differences, fig.cap ="Gender Analysis", fig.width=12, fig.height=16, fig.pos = "H", out.width="100%", layout="l-body"}
math_plot + read_plot + sci_plot
```


Figure \@ref(fig:score-differences) shows differences between mean scores for the three topics. 

## Math Maps


```{r}
theme_map <- function(...) {
  theme_minimal() +
  theme(
    text = element_text(),
    axis.line = element_blank(),
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.border = element_blank(),
    ...
  )
}
```

```{r}
math_map_data <- math_diff_conf_intervals %>% 
  dplyr::mutate(country_name = case_when(
                country_name == "Brunei Darussalam" ~ "Brunei",
                country_name == "United Kingdom" ~ "UK",
                country_name %in% c("Macau SAR China", "B-S-J-Z (China)", 
                                    "Hong Kong SAR China") ~ "China",
                country_name == "Korea" ~ "South Korea",
                country_name == "North Macedonia" ~ "Macedonia",
                country_name == "Baku (Azerbaijan)" ~ "Baku",
                country_name %in% c("Moscow Region (RUS)", "Tatarstan (RUS)",
                "Russian Federation") ~ "Russia",
                country_name == "Slovak Republic" ~ "Slovakia",
                country_name == "Chinese Taipei" ~ "Taiwan",
                country_name == "United States" ~ "USA",
                TRUE ~ as.character(country_name)))

world_map <- map_data("world") %>% 
  filter(region != "Antarctica") %>% 
  fortify() %>% 
  rename(country_name = region)

math_world_data <- full_join(math_map_data,
                        world_map,
                        by = "country_name") 

math_world_data <- math_world_data %>% 
  rename(Country = country_name, 
         `Maths Scores Girls - Boys` = diff)


math_map_plot <- ggplot(math_world_data, 
                        aes(x = long, y = lat, group = group)) +
                  geom_polygon(aes(fill= `Maths Scores Girls - Boys`, 
                                   label = Country)) +
                  theme_map() +
                  labs(title = "World Map displaying Maths Scores Difference") +
                  scale_fill_viridis(option = "D")
```

## Read Maps

```{r}
# Maps in R - Reading Maps
read_map_data <- read_diff_conf_intervals %>% 
  dplyr::mutate(country_name = case_when(
                country_name == "Brunei Darussalam" ~ "Brunei",
                country_name == "United Kingdom" ~ "UK",
                country_name %in% c("Macau SAR China", "B-S-J-Z (China)", 
                                    "Hong Kong SAR China") ~ "China",
                country_name == "Korea" ~ "South Korea",
                country_name == "North Macedonia" ~ "Macedonia",
                country_name == "Baku (Azerbaijan)" ~ "Baku",
                country_name %in% c("Moscow Region (RUS)", "Tatarstan (RUS)",
                "Russian Federation") ~ "Russia",
                country_name == "Slovak Republic" ~ "Slovakia",
                country_name == "Chinese Taipei" ~ "Taiwan",
                country_name == "United States" ~ "USA",
                TRUE ~ as.character(country_name)))

world_map <- map_data("world") %>% 
  filter(region != "Antarctica") %>% 
  fortify() %>% 
  rename(country_name = region)

read_world_data <- full_join(read_map_data,
                        world_map,
                        by = "country_name") 

read_world_data <- read_world_data %>% 
  rename(Country = country_name, 
         `Reading Scores Girls - Boys` = diff)



read_map_plot <- ggplot(read_world_data, 
                        aes(x = long, y = lat, group = group)) +
                  geom_polygon(aes(fill= `Reading Scores Girls - Boys`, 
                                   label = Country)) +
                  theme_map() +
                  labs(title = "World Map displaying Reading Scores Difference") +
                  scale_fill_viridis(option = "C")
                  
```


## Science Maps

```{r}
sci_map_data <- sci_diff_conf_intervals %>% 
  dplyr::mutate(country_name = case_when(
                country_name == "Brunei Darussalam" ~ "Brunei",
                country_name == "United Kingdom" ~ "UK",
                country_name %in% c("Macau SAR China", "B-S-J-Z (China)", 
                                    "Hong Kong SAR China") ~ "China",
                country_name == "Korea" ~ "South Korea",
                country_name == "North Macedonia" ~ "Macedonia",
                country_name == "Baku (Azerbaijan)" ~ "Baku",
                country_name %in% c("Moscow Region (RUS)", "Tatarstan (RUS)",
                "Russian Federation") ~ "Russia",
                country_name == "Slovak Republic" ~ "Slovakia",
                country_name == "Chinese Taipei" ~ "Taiwan",
                country_name == "United States" ~ "USA",
                TRUE ~ as.character(country_name)))

world_map <- map_data("world") %>% 
  filter(region != "Antarctica") %>% 
  fortify() %>% 
  rename(country_name = region)

sci_world_data <- full_join(sci_map_data,
                        world_map,
                        by = "country_name") 

sci_world_data <- sci_world_data %>% 
  rename(Country = country_name, 
         `Science Scores Girls - Boys` = diff)

sci_map_plot <- ggplot(sci_world_data, 
                        aes(x = long, y = lat, group = group)) +
                  geom_polygon(aes(fill= `Science Scores Girls - Boys`, 
                                   label = Country)) +
                  theme_map() +
                  labs(title = "World Map displaying Science Scores Difference") +
                  scale_fill_viridis(option = "G")
```


```{r plotly_maps, fig.cap="Plotly Maps", fig.pos="H", fig.height=6, fig.width=12, include=knitr::is_html_output(), eval=knitr::is_html_output()}
ggplotly(math_map_plot)
ggplotly(read_map_plot)
ggplotly(sci_map_plot)
```


Figure \@ref(fig:plotly_maps) shows differences between mean scores for the three topics. 

```{r ggplot-maps, fig.cap="Maps", fig.height=9, fig.pos="H", include=knitr::is_latex_output(), eval=knitr::is_latex_output()}
math_map_plot/read_map_plot/sci_map_plot
```


Figure \@ref(fig:ggplot-maps) shows differences between mean scores for the three topics. 

# Socioeconomic Factors Analysis 






# Temoral Trend Australia 

# Discussion




